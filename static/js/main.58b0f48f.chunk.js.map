{"version":3,"sources":["components/Box.js","hooks/boxesState.js","components/BoxEditor.js","hooks/usePointerEvents.js","components/Boxes.js","index.js","App.js"],"names":["Box","_ref","isActive","_ref$box","box","top","left","width","height","text","boxProps","className","style","react_default","a","createElement","initialState","boxes","selectedIndex","editMode","createBoxesAction","createAction","selectBoxAtPointAction","moveBoxAction","setBoxEditModeAction","updateSelectedBoxAction","reducer","handlers","map","Map","_ref2","Object","slicedToArray","ac","handler","toString","state","action","get","type","createReducer","_action$payload","payload","count","Array","fill","v","idx","id","concat","Math","random","objectSpread","_action$payload2","x","y","reduce","foundIndex","x1","x2","y1","y2","_action$payload3","offsetX","offsetY","updatedBox","actionCreator","nonActiveBox","BoxEditor","onBoxModified","cancelEditMode","_useState","useState","_useState2","setText","inputRef","useRef","useEffect","current","focus","setTimeout","select","inputProps","value","onChange","evt","target","onKeyDown","key","preventDefault","onBlur","ref","DOUBLE_TAP_DELAY","getPointerEventData","container","clientX","clientY","_container$getBoundin","getBoundingClientRect","_target$getBoundingCl","usePointerEvents","containerRef","callbackApi","elapsedTime","lastTime","Date","now","thisTime","elapsedTimeKeeper","subjects","pointerDownSubject","Subject","pointerMoveSubject","pointerUpSubject","onPointerDown","useCallback","evtData","setPointerCapture","pointerId","next","editItem","onPointerMove","onPointerUp","onPointerCancel","releasePointerCapture","pointerDownStream","asObservable","pointerMoveStream","pointerUpStream","subscription","pipe","found","findItem","filter","switchMap","tap","_ref3","dragItem","takeUntil","dragComplete","subscribe","unsubscribe","Boxes","_useReducer","useReducer","_useReducer2","_useReducer2$","dispatch","_containerRef$current","useMemo","_usePointerEvents","divProps","boxEditorProps","undefined","ReactDOM","render","href","Boxes_Boxes","document","getElementById"],"mappings":"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","file":"static/js/main.58b0f48f.chunk.js","sourcesContent":["import React from \"react\";\r\n\r\nexport function Box({ isActive, box: { top, left, width, height, text } }) {\r\n  const boxProps = {\r\n    className: \"box\" + (isActive ? \" active\" : \"\"),\r\n    style: {\r\n      top,\r\n      left,\r\n      width,\r\n      height\r\n    }\r\n  };\r\n  return <div {...boxProps}>{text}</div>;\r\n}\r\n","export const boxWidth = 200;\r\nexport const boxHeight = 70;\r\n\r\nexport const initialState = {\r\n  boxes: [],\r\n  selectedIndex: -1,\r\n  editMode: false\r\n};\r\n\r\nexport const createBoxesAction = createAction(\"CREATE_BOXES\");\r\nexport const selectBoxAtPointAction = createAction(\"SELECT_BOX_AT_POINT\");\r\nexport const moveBoxAction = createAction(\"MOVE_BOX\");\r\nexport const setBoxEditModeAction = createAction(\"SET_BOX_EDIT_MODE\");\r\nexport const updateSelectedBoxAction = createAction(\"UPDATE_SELECT_BOX\");\r\n\r\nexport const reducer = createReducer([\r\n  [\r\n    createBoxesAction,\r\n    (state, action) => {\r\n      const { count, width, height } = action.payload;\r\n      const boxes = new Array(count).fill(0).map((v, idx) => ({\r\n        id: `box-${idx + 1}`,\r\n        top: Math.random() * (height - boxHeight),\r\n        left: Math.random() * (width - boxWidth),\r\n        width: boxWidth,\r\n        height: boxHeight,\r\n        text: `Box ${idx + 101}`\r\n      }));\r\n      return { ...state, boxes };\r\n    }\r\n  ],\r\n  [\r\n    selectBoxAtPointAction,\r\n    (state, action) => {\r\n      const { x, y } = action.payload;\r\n      const selectedIndex = state.boxes.reduce((foundIndex, box, idx) => {\r\n        const x1 = box.left;\r\n        const x2 = box.left + box.width;\r\n        const y1 = box.top;\r\n        const y2 = box.top + box.height;\r\n        if (x >= x1 && x <= x2 && y >= y1 && y <= y2) {\r\n          if (foundIndex === -1 || idx === state.selectedIndex) {\r\n            foundIndex = idx;\r\n          }\r\n        }\r\n        return foundIndex;\r\n      }, -1);\r\n      return { ...state, selectedIndex };\r\n    }\r\n  ],\r\n  [\r\n    moveBoxAction,\r\n    (state, action) => {\r\n      const { boxes, selectedIndex } = state;\r\n      if (selectedIndex === -1) {\r\n        return state;\r\n      }\r\n\r\n      const { x, y, offsetX, offsetY } = action.payload;\r\n      const updatedBox = {\r\n        ...boxes[selectedIndex],\r\n        left: x - offsetX,\r\n        top: y - offsetY\r\n      };\r\n      return {\r\n        ...state,\r\n        boxes: boxes.map((box, idx) =>\r\n          idx === selectedIndex ? updatedBox : box\r\n        )\r\n      };\r\n    }\r\n  ],\r\n  [\r\n    setBoxEditModeAction,\r\n    (state, action) => {\r\n      const { editMode } = action.payload;\r\n      return { ...state, editMode };\r\n    }\r\n  ],\r\n  [\r\n    updateSelectedBoxAction,\r\n    (state, action) => {\r\n      const { boxes, selectedIndex } = state;\r\n      if (selectedIndex === -1) {\r\n        return state;\r\n      }\r\n\r\n      const { box: updatedBox } = action.payload;\r\n      return {\r\n        ...state,\r\n        boxes: boxes.map((box, idx) =>\r\n          idx === selectedIndex ? updatedBox : box\r\n        )\r\n      };\r\n    }\r\n  ]\r\n]);\r\n\r\nfunction createAction(type) {\r\n  function actionCreator(payload) {\r\n    return {\r\n      type,\r\n      payload\r\n    };\r\n  }\r\n  actionCreator.toString = () => type;\r\n  return actionCreator;\r\n}\r\n\r\nfunction createReducer(handlers) {\r\n  const map = new Map(\r\n    handlers.map(([ac, handler]) => [ac.toString(), handler])\r\n  );\r\n  return (state, action) => {\r\n    const handler = map.get(action.type) || (() => state);\r\n    return handler(state, action);\r\n  };\r\n}\r\n","import React, { useState, useRef, useEffect } from \"react\";\r\nimport { boxHeight, boxWidth } from \"../hooks/boxesState\";\r\n\r\nconst nonActiveBox = {\r\n  top: 0,\r\n  left: -9999,\r\n  width: boxWidth,\r\n  height: boxHeight\r\n};\r\n\r\nexport function BoxEditor({ box, onBoxModified, cancelEditMode }) {\r\n  const [text, setText] = useState(\"\");\r\n  const inputRef = useRef(null);\r\n  useEffect(() => {\r\n    if (box) {\r\n      inputRef.current.focus();\r\n      setText(box.text);\r\n      setTimeout(() => {\r\n        inputRef.current.select();\r\n      });\r\n    }\r\n  }, [box]);\r\n\r\n  const { top, left, width, height } = box || nonActiveBox;\r\n  const boxProps = {\r\n    className: \"box active editor\",\r\n    style: { top, left, width, height }\r\n  };\r\n  const inputProps = {\r\n    type: \"text\",\r\n    value: text,\r\n    onChange: evt => setText(evt.target.value),\r\n    onKeyDown: evt => {\r\n      if (box) {\r\n        if (evt.key === \"Enter\") {\r\n          evt.preventDefault();\r\n          onBoxModified({ ...box, text });\r\n          cancelEditMode();\r\n        } else if (evt.key === \"Escape\") {\r\n          evt.preventDefault();\r\n          cancelEditMode();\r\n        }\r\n      }\r\n    },\r\n    onBlur: () => {\r\n      if (box) {\r\n        onBoxModified({ ...box, text });\r\n        cancelEditMode();\r\n      }\r\n    },\r\n    ref: inputRef\r\n  };\r\n  return (\r\n    <div {...boxProps}>\r\n      <input {...inputProps} />\r\n    </div>\r\n  );\r\n}\r\n","import { useRef, useEffect, useCallback } from \"react\";\r\nimport { Subject } from \"rxjs\";\r\nimport { map, filter, tap, switchMap, takeUntil } from \"rxjs/operators\";\r\n\r\nconst DOUBLE_TAP_DELAY = 300;\r\n\r\nfunction elapsedTimeKeeper() {\r\n  let lastTime = Date.now();\r\n  return () => {\r\n    const thisTime = Date.now();\r\n    const elapsedTime = thisTime - lastTime;\r\n    lastTime = thisTime;\r\n    return elapsedTime;\r\n  };\r\n}\r\n\r\nfunction getPointerEventData(evt, container) {\r\n  const { clientX, clientY, target } = evt;\r\n  const { left, top } = container.getBoundingClientRect();\r\n  const { left: targetLeft, top: targetTop } = target.getBoundingClientRect();\r\n  const x = clientX - left;\r\n  const y = clientY - top;\r\n  const offsetX = clientX - targetLeft;\r\n  const offsetY = clientY - targetTop;\r\n  return { x, y, offsetX, offsetY };\r\n}\r\n\r\nexport function usePointerEvents(containerRef, callbackApi) {\r\n  const elapsedTime = useRef(elapsedTimeKeeper());\r\n  const subjects = useRef({\r\n    pointerDownSubject: new Subject(),\r\n    pointerMoveSubject: new Subject(),\r\n    pointerUpSubject: new Subject()\r\n  });\r\n\r\n  const onPointerDown = useCallback(\r\n    evt => {\r\n      const evtData = getPointerEventData(evt, containerRef.current);\r\n      if (elapsedTime.current() > DOUBLE_TAP_DELAY) {\r\n        containerRef.current.setPointerCapture(evt.pointerId);\r\n        subjects.current.pointerDownSubject.next(evtData);\r\n      } else {\r\n        callbackApi.editItem(evtData);\r\n      }\r\n    },\r\n    [containerRef, elapsedTime, callbackApi]\r\n  );\r\n  const onPointerMove = useCallback(\r\n    evt => {\r\n      const evtData = getPointerEventData(evt, containerRef.current);\r\n      subjects.current.pointerMoveSubject.next(evtData);\r\n    },\r\n    [containerRef]\r\n  );\r\n  const onPointerUp = useCallback(\r\n    evt => {\r\n      const evtData = getPointerEventData(evt, containerRef.current);\r\n      subjects.current.pointerUpSubject.next(evtData);\r\n    },\r\n    [containerRef]\r\n  );\r\n  const onPointerCancel = useCallback(\r\n    evt => {\r\n      containerRef.current.releasePointerCapture(evt.pointerId);\r\n    },\r\n    [containerRef]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const pointerDownStream = subjects.current.pointerDownSubject.asObservable();\r\n    const pointerMoveStream = subjects.current.pointerMoveSubject.asObservable();\r\n    const pointerUpStream = subjects.current.pointerUpSubject.asObservable();\r\n\r\n    const orchestrationStream = pointerDownStream.pipe(\r\n      map(evtData => ({\r\n        ...evtData,\r\n        found: callbackApi.findItem(evtData)\r\n      })),\r\n      filter(({ found }) => found),\r\n      switchMap(({ offsetX, offsetY }) => {\r\n        return pointerMoveStream.pipe(\r\n          tap(({ x, y }) => {\r\n            callbackApi.dragItem({ x, y, offsetX, offsetY });\r\n          }),\r\n          takeUntil(\r\n            pointerUpStream.pipe(\r\n              tap(() => {\r\n                callbackApi.dragComplete();\r\n              })\r\n            )\r\n          )\r\n        );\r\n      })\r\n    );\r\n\r\n    const subscription = orchestrationStream.subscribe();\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, [callbackApi]);\r\n\r\n  return {\r\n    onPointerDown,\r\n    onPointerMove,\r\n    onPointerUp,\r\n    onPointerCancel\r\n  };\r\n}\r\n","import React, {\r\n  useRef,\r\n  useEffect,\r\n  useReducer,\r\n  useCallback,\r\n  useMemo\r\n} from \"react\";\r\nimport { Box } from \"./Box\";\r\nimport { BoxEditor } from \"./BoxEditor\";\r\nimport { usePointerEvents } from \"../hooks/usePointerEvents\";\r\nimport {\r\n  createBoxesAction,\r\n  initialState,\r\n  reducer,\r\n  setBoxEditModeAction,\r\n  selectBoxAtPointAction,\r\n  moveBoxAction,\r\n  updateSelectedBoxAction\r\n} from \"../hooks/boxesState\";\r\n\r\nimport \"./Boxes.css\";\r\n\r\nexport function Boxes() {\r\n  const [{ boxes, selectedIndex, editMode }, dispatch] = useReducer(\r\n    reducer,\r\n    initialState\r\n  );\r\n\r\n  const containerRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const count = 10;\r\n    const { width, height } = containerRef.current.getBoundingClientRect();\r\n    dispatch(createBoxesAction({ width, height, count }));\r\n  }, []);\r\n\r\n  const editItem = useCallback(({ x, y }) => {\r\n    dispatch(selectBoxAtPointAction({ x, y }));\r\n    dispatch(setBoxEditModeAction({ editMode: true }));\r\n  }, []);\r\n  const findItem = useCallback(({ x, y }) => {\r\n    dispatch(selectBoxAtPointAction({ x, y }));\r\n    return true;\r\n  }, []);\r\n  const dragItem = useCallback(({ x, y, offsetX, offsetY }) => {\r\n    dispatch(moveBoxAction({ x, y, offsetX, offsetY }));\r\n  }, []);\r\n  const dragComplete = useCallback(() => {}, []);\r\n  const callbackApi = useMemo(\r\n    () => ({\r\n      editItem,\r\n      findItem,\r\n      dragItem,\r\n      dragComplete\r\n    }),\r\n    [editItem, findItem, dragItem, dragComplete]\r\n  );\r\n\r\n  const {\r\n    onPointerDown,\r\n    onPointerMove,\r\n    onPointerUp,\r\n    onPointerCancel\r\n  } = usePointerEvents(containerRef, callbackApi);\r\n\r\n  const divProps = {\r\n    className: \"boxes\",\r\n    ref: containerRef,\r\n    onPointerDown,\r\n    onPointerMove,\r\n    onPointerUp,\r\n    onPointerCancel\r\n  };\r\n\r\n  const boxEditorProps = {\r\n    box: editMode ? boxes[selectedIndex] : undefined,\r\n    onBoxModified: box => {\r\n      dispatch(updateSelectedBoxAction({ box }));\r\n    },\r\n    cancelEditMode: () => {\r\n      dispatch(setBoxEditModeAction({ editMode: false }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div {...divProps}>\r\n      <BoxEditor {...boxEditorProps} />\r\n      {boxes.map((box, idx) => (\r\n        <Box key={box.id} box={box} isActive={idx === selectedIndex} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { App } from \"./App\";\r\n\r\nimport \"./index.css\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n","import React from \"react\";\r\nimport { Boxes } from \"./components/Boxes\";\r\nimport \"./App.css\";\r\n\r\nexport function App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <div>\r\n        <h2>React Mouse/Touch Events Demo</h2>\r\n        <p>\r\n          Source:\r\n          <a href=\"https://github.com/dfbaskin/react-mouse-touch-events\">\r\n            https://github.com/dfbaskin/react-mouse-touch-events\r\n          </a>\r\n        </p>\r\n      </div>\r\n      <div>\r\n        <Boxes />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"sourceRoot":""}